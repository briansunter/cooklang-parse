/**
 * Cooklang Grammar for Ohm - Canonical Format
 * Based on official Cooklang spec at https://cooklang.org/docs/spec/
 */

Cooklang {
  recipe
    = metadata? nonCommentLines

  nonCommentLines
    = line* end

  line
    = blankLine | comment | stepLine

  blankLine
    = " "* "\n" | " "* "\r\n" | " "* "\r"

  comment
    = "--" (~("\n" | "\r\n" | "\r") any)* ("\n" | "\r\n" | "\r")

  stepLine
    = content ("\n" | "\r\n" | "\r")

  content
    = item*

  item
    = cookware | timer | ingredient | comment_inline | text

  text
    = (~("\n" | "\r\n" | "\r" | "@" | "#" | "~") any)+

  comment_inline
    = " "* "--" (~("\n" | "\r\n" | "\r") any)*

  // ========== INGREDIENTS ==========
  ingredient
    = "@" ingredientNameMultiWord ingredientAmount
    | "@" ingredientNameSingleWord ingredientAmount?

  ingredientNameSingleWord
    = wordChar+

  ingredientNameMultiWord
    = wordChar+ (" "+ wordChar+)+

  ingredientAmount
    = "{" (~"}" any)* "}"

  // ========== COOKWARE ==========
  cookware
    = "#" cookwareNameMultiWord cookwareAmount
    | "#" cookwareNameSingleWord cookwareAmount?

  cookwareNameSingleWord
    = wordChar+

  cookwareNameMultiWord
    = wordChar+ (" "+ wordChar+)+

  cookwareAmount
    = "{" (~"}" any)* "}"



  // ========== METADATA ==========
  metadata
    = "---" metadataContent "---" ("\n" | "\r\n" | "\r")*

  metadataContent
    = (~"---" any)*

  // ========== METADATA ==========
  metadata
    = "---" metadataContent "---" ("\n" | "\r\n" | "\r")*

  metadataContent
    = (~"---" any)*

  // ========== BASIC TOKENS ==========
  // nl is a rule, but Ohm provides it natively

  wordChar
    = letter | digit | "_" | emoji | otherWordChar

  emoji
    = "\u{1F600}".."\u{1F64F}"
    | "\u{1F300}".."\u{1F5FF}"
    | "\u{1F680}".."\u{1F6FF}"
    | "\u{2600}".."\u{26FF}"
    | "\u{2700}".."\u{27BF}"
    | "\u{1F900}".."\u{1F9FF}"
    | "\u{1FA70}".."\u{1FAFF}"

  otherWordChar
    = "\u00C0".."\u00FF"
    | "\u0100".."\u017F"
    | "\u0400".."\u04FF"

  wordBoundary
    = " " | "\t" | punctuation | "\n" | "\r\n" | "\r"

  punctuation
    = "!" | "," | "." | ";" | ":" | "?" | "'" | "\"" | "..." | "-" | "_" | "(" | ")" | "[" | "]" | "{" | "}"
    | "/" | "\\" | "|" | "@" | "#" | "$" | "%" | "^" | "&" | "*" | "+" | "=" | "<" | ">" | "~" | "`" | "\u{2E2C}" | unicodePunct

  unicodePunct
    = "\u{2000}".."\u{206F}"
    | "\u{2E00}".."\u2E7F"

}
